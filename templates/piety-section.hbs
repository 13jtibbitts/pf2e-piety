<header>{{localize "Pf2ePiety.Piety"}}</header>
<!-- Use Nav for PHASE 2
<nav class="actions-nav sub-nav" data-group="piety-tabs"> {{! FIXME: Piety Tabs must be added, and needs local classes.}}
    <a class="tab active" data-tab="piety-overview" data-group="piety-tabs">{{localize "Pf2ePiety.Overview"}}</a>
    <a class="tab" data-tab="piety-details" data-group="piety-tabs">{{localize "Pf2ePiety.Details"}}</a>
    <a class="tab" data-tab="piety-goals" data-group="piety-tabs">{{localize "Pf2ePiety.Goals"}}</a>
</nav>-->
<div class="piety-main">
    <div>
        <h2 class="piety-score-heading">
            <span>{{localize "Pf2ePiety.Deity"}}</span>
        </h2>
        {{#if deity}}
            <h3 class="attribute deity-info">
                <span>{{deity.name}}</span>
                <div class="deity-emblem">
                    <img src="{{deity.img}}" alt="{{deity.name}}" />
                </div>
            </h3>
        {{else}}
            <h3>{{localize "Pf2ePiety.MissingDeity"}}</h3>
        {{/if}}
    </div>
    <div class="attribute">
        <h2 class="piety-score-heading">
            <span>{{localize "Pf2ePiety.PietyScore"}}</span>
        </h2>
        <div class="piety-score-modifier">
            <button type="button" data-action="piety-score-decrease">-</button>
            <h3 aria-label="Pf2ePiety.Piety">
                {{piety.pietyScore}}
            </h3>
            <button type="button" data-action="piety-score-increase">+</button>
        </div>
    </div>
</div>
<!-- <div>{{{deity.system.description.value}}}</div> {{! Add to Details Tab for Phase 2. }}-->
{{! Edicts and Anathema}}
<div class="bio edicts" data-field="edicts" data-tooltip-direction="LEFT">
    <div class="label-add edict-anathema">
        <label
            class="details-label"
            {{#if piety.edicts}}
            for="{{document.uuid}}-piety-edicts"{{/if}}
        >{{localize "Pf2ePiety.Edicts"}}</label>
        <a
            data-action="add-piety-edict-anathema"
            data-tooltip="PF2E.Actor.Character.Biography.Edicts.Add"
        ><i class="fa-solid fa-plus"></i></a>
    </div>
    <ol class="edict-anathema">
        {{~#each piety.edicts as |line index|~}}
            <li>
                <p>{{increment index}}.</p>
                <input
                    type="text"
                    {{#if (eq index 0)}}id="{{../document.uuid}}-edicts"{{/if}} {{!FIXME: Change}}
                    name="character.flags['pf2e-piety'].edicts.{{index}}"
                    value="{{line}}"
                />
                <a
                    data-action="delete-piety-edict-anathema"
                    data-tooltip="PF2E.Actor.Character.Biography.Edicts.Delete"
                    data-index="{{index}}"
                ><i class="fa-solid fa-trash"></i></a>
            </li>
        {{/each}}
    </ol>
</div>
<div class="bio anathema" data-field="anathema" data-tooltip-direction="LEFT">
    <div class="label-add edict-anathema">
        <label
            class="details-label"
            {{#if biography.anathema}}
            for="{{document.uuid}}-piety-anathema"{{/if}}
        >{{localize "Pf2ePiety.Anathema"}}</label>
        <a
            data-action="add-piety-edict-anathema"
            data-tooltip="PF2E.Actor.Character.Biography.Anathema.Add"
        ><i class="fa-solid fa-plus"></i></a>
    </div>
    <ol class="edict-anathema">
        {{~#each anathema as |line index|~}}
            <li>
                <p>{{increment index}}.</p>
                <input
                    type="text"
                    {{#if (eq index 0)}}id="{{../document.uuid}}-anathema"{{/if}}
                    name="character.flags['pf2e-piety'].anathema.{{index}}"
                    value="{{line}}"
                />
                <a
                    data-action="delete-piety-edict-anathema"
                    data-tooltip="PF2E.Actor.Character.Biography.Anathema.Delete"
                    data-index="{{index}}"
                ><i class="fa-solid fa-trash"></i></a>
            </li>
        {{/each}}
    </ol>
 </div>
{{! Piety Thresholds }}
<h2 class="piety-score-heading">{{localize "Pf2ePiety.Boons"}}</h2>
<ol class="thresholds">
    <li>
        {{> boonSlot threshold=threshold1 boon=piety.boon1}}
    </li>
    <li>
        {{> boonSlot threshold=threshold2 boon=piety.boon2}}
    </li>
    <li>
        {{> boonSlot threshold=threshold3 boon=piety.boon3}}
    </li>
    <li>
        {{> boonSlot threshold=threshold4 boon=piety.boon4}}
    </li>
</ol>

{{! Piety Boon Slot Partial }}
{{#*inline "boonSlot"}}
<label class="details-label">{{localize "Pf2ePiety.Piety"}} {{threshold}}</label>
{{#if boon}}
    <p>{{boon.name}}</p>
    <a
        data-action={{boon.deleteAction}}
        data-tooltip="PF2E.Actor.Character.Biography.Edicts.Delete" <!-- FIXME: Change tooltip -->
    ><i class="fa-solid fa-trash"></i></a>
{{else}}
    <p>{{localize "Pf2ePiety.BoonHint"}}</p>
{{/if}}
{{/inline}}

{{! EDIT: Add Feat-Slot partials similar to pf2e's feat-slot.hbs }}
{{#*inline "featSlot"}}
{{#if featSlot.feat}}
    <li class="item feat-item" data-item-id="{{featSlot.feat.id}}" data-slot-id="{{featSlot.id}}">
        <div class="item-name drag-handle">
            <div class="feat-slot-title">{{featSlot.label}}</div>
            <a class="item-image framed" data-action="item-to-chat">
                <img class="item-icon" src="{{featSlot.feat.img}}" alt="{{featSlot.feat.name}}">
                <i class="fa-solid fa-message"></i>
            </a>
            <h4 class="name"><a data-action="toggle-summary">{{featSlot.feat.name}}</a></h4>
        </div>
        <div class="item-controls">
            {{#if @root.editable}}
                <a data-action="edit-item" data-tooltip="PF2E.EditItemTitle"><i class="fa-solid fa-fw fa-edit"></i></a>
                <a data-action="delete-item" data-tooltip="PF2E.DeleteItemTitle"><i class="fa-solid fa-fw fa-trash"></i></a>
            {{/if}}
        </div>
        <div class="item-summary" hidden></div>
    </li>
{{else}}
        {{> emptySlot slot=featSlot}}
{{/if}}

{{#*inline "emptySlot"}}
    <li class="feat-item" data-slot-id="{{slot.id}}">
        <div class="item-name">
            <div class="feat-slot-title">{{slot.label}}</div>
            <div class="item-placeholder">{{coalesce slot.restriction.hint (localize "PF2E.EmptySlot")}}</div>
        </div>
        <div class="item-controls">
            {{#if @root.editable}}
                <a
                    data-action="browse-feats"
                    data-filter="{{featFilter}},conjunction-or"
                    data-level="{{slot.level}}"
                ><i class="fa-solid fa-fw fa-search"></i></a>
            {{/if}}
        </div>
    </li>
{{/inline}}
{{/inline}}